(()=>{const e=(new Date).getTime(),{Application:a,live2d:{Live2DModel:t}}=PIXI,{Face:r,Vector:{lerp:o},Utils:{clamp:i}}=Kalidokit,n=(e=>{let a={hiyori:{key:"hiyori",name:"Hiyori",path:"hiyori_pro_en/runtime/hiyori_pro_t10.model3.json",isMale:!1,isDefault:!0},natori:{key:"natori",name:"Natori",path:"natori_pro_en/runtime/natori_pro_t06.model3.json",isMale:!0,isDefault:!0}}[new URL(window.location.href).searchParams.get("model")];return a||([a]=Object.values({hiyori:{key:"hiyori",name:"Hiyori",path:"hiyori_pro_en/runtime/hiyori_pro_t10.model3.json",isMale:!1,isDefault:!0},natori:{key:"natori",name:"Natori",path:"natori_pro_en/runtime/natori_pro_t06.model3.json",isMale:!0,isDefault:!0}}).filter((e=>e.isDefault&&e.isMale))),`assets/models/${a.path}`})();let l,d;document.querySelector(".preview");const m=document.querySelector(".input_video"),s=document.querySelector("canvas.guides");!async function(){console.log("Environment: false");const e=new PIXI.Application({view:document.getElementById("live2d"),autoStart:!0,backgroundAlpha:0,backgroundColor:16777215,resizeTo:window});l=await t.from(n,{autoInteract:!1}),l.scale.set(.2),l.interactive=!0,l.anchor.set(.5,.5),l.position.set(.5*window.innerWidth,window.innerHeight),l.on("pointerdown",(e=>{l.offsetX=e.data.global.x-l.position.x,l.offsetY=e.data.global.y-l.position.y,l.dragging=!0})),l.on("pointerup",(e=>{l.dragging=!1})),l.on("pointermove",(e=>{l.dragging&&l.position.set(e.data.global.x-l.offsetX,e.data.global.y-l.offsetY)})),document.querySelector("#live2d").addEventListener("wheel",(e=>{e.preventDefault(),l.scale.set(i(l.scale.x+-.001*e.deltaY,-.5,10))})),e.stage.addChild(l),d=new FaceMesh({locateFile:e=>`libs/@mediapipe/face_mesh/${e}`}),d.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),d.onResults(u),h()}();const u=a=>{y(a.multiFaceLandmarks[0]),(new Date).getTime()-e>3e3&&g(a.multiFaceLandmarks[0])},y=e=>{if(!s||!m||!e)return;s.width=m.videoWidth,s.height=m.videoHeight;const a=s.getContext("2d");a.save(),a.clearRect(0,0,s.width,s.height),drawConnectors(a,e,FACEMESH_TESSELATION,{color:"#C0C0C070",lineWidth:1}),e&&478===e.length&&drawLandmarks(a,[e[468],e[473]],{color:"#ffe603",lineWidth:2})},g=e=>{if(!l||!e)return;let a;e&&(a=r.solve(e,{runtime:"mediapipe",video:m}),c(a,.5))},c=(e,a=.7)=>{if(!l||!e)return;const{coreModel:t}=l.internalModel;l.internalModel.motionManager.update=(...r)=>{l.internalModel.eyeBlink=void 0,t.setParameterValueById("ParamEyeBallX",o(e.pupil.x,t.getParameterValueById("ParamEyeBallX"),a)),t.setParameterValueById("ParamEyeBallY",o(e.pupil.y,t.getParameterValueById("ParamEyeBallY"),a)),t.setParameterValueById("ParamAngleX",o(e.head.degrees.y,t.getParameterValueById("ParamAngleX"),a)),t.setParameterValueById("ParamAngleY",o(e.head.degrees.x,t.getParameterValueById("ParamAngleY"),a)),t.setParameterValueById("ParamAngleZ",o(e.head.degrees.z,t.getParameterValueById("ParamAngleZ"),a));const i=.66;t.setParameterValueById("ParamBodyAngleX",o(e.head.degrees.y*i,t.getParameterValueById("ParamBodyAngleX"),a)),t.setParameterValueById("ParamBodyAngleY",o(e.head.degrees.x*i,t.getParameterValueById("ParamBodyAngleY"),a)),t.setParameterValueById("ParamBodyAngleZ",o(e.head.degrees.z*i,t.getParameterValueById("ParamBodyAngleZ"),a));const n=Kalidokit.Face.stabilizeBlink({l:o(e.eye.l,t.getParameterValueById("ParamEyeLOpen"),.7),r:o(e.eye.r,t.getParameterValueById("ParamEyeROpen"),.7)},e.head.y);t.setParameterValueById("ParamEyeLOpen",n.l),t.setParameterValueById("ParamEyeROpen",n.r),t.setParameterValueById("ParamMouthOpenY",o(e.mouth.y,t.getParameterValueById("ParamMouthOpenY"),.3)),t.setParameterValueById("ParamMouthForm",.3+o(e.mouth.x,t.getParameterValueById("ParamMouthForm"),.3))}},h=()=>{new Camera(m,{onFrame:async()=>{await d.send({image:m})},width:640,height:480}).start().then((e=>{}))}})();