(()=>{const{Application:e,live2d:{Live2DModel:a}}=PIXI,{Face:t,Vector:{lerp:r},Utils:{clamp:o}}=Kalidokit,n=(e=>{let a={hiyori:{key:"hiyori",name:"Hiyori",path:"hiyori_pro_en/runtime/hiyori_pro_t10.model3.json",isMale:!1,isDefault:!0},natori:{key:"natori",name:"Natori",path:"natori_pro_en/runtime/natori_pro_t06.model3.json",isMale:!0,isDefault:!0}}[new URL(window.location.href).searchParams.get("model")];return a||([a]=Object.values({hiyori:{key:"hiyori",name:"Hiyori",path:"hiyori_pro_en/runtime/hiyori_pro_t10.model3.json",isMale:!1,isDefault:!0},natori:{key:"natori",name:"Natori",path:"natori_pro_en/runtime/natori_pro_t06.model3.json",isMale:!0,isDefault:!0}}).filter((e=>e.isDefault&&e.isMale))),`assets/models/${a.path}`})();let i;const l=e=>{if(e.origin!==window.location.origin)return;const{data:{points:a,timestamp:o},origin:n,source:l}=e;if(!i||!a)return;let d;console.debug(`Apply animation with totalPoints=${a.length} sample=${JSON.stringify(a[0])}`),a&&(d=t.solve(a,{runtime:"mediapipe"}),((e,a=.7)=>{if(!i||!e)return;const{coreModel:t}=i.internalModel;i.internalModel.motionManager.update=(...o)=>{i.internalModel.eyeBlink=void 0,t.setParameterValueById("ParamEyeBallX",r(e.pupil.x,t.getParameterValueById("ParamEyeBallX"),a)),t.setParameterValueById("ParamEyeBallY",r(e.pupil.y,t.getParameterValueById("ParamEyeBallY"),a)),t.setParameterValueById("ParamAngleX",r(e.head.degrees.y,t.getParameterValueById("ParamAngleX"),a)),t.setParameterValueById("ParamAngleY",r(e.head.degrees.x,t.getParameterValueById("ParamAngleY"),a)),t.setParameterValueById("ParamAngleZ",r(e.head.degrees.z,t.getParameterValueById("ParamAngleZ"),a));const n=.66;t.setParameterValueById("ParamBodyAngleX",r(e.head.degrees.y*n,t.getParameterValueById("ParamBodyAngleX"),a)),t.setParameterValueById("ParamBodyAngleY",r(e.head.degrees.x*n,t.getParameterValueById("ParamBodyAngleY"),a)),t.setParameterValueById("ParamBodyAngleZ",r(e.head.degrees.z*n,t.getParameterValueById("ParamBodyAngleZ"),a));const l=Kalidokit.Face.stabilizeBlink({l:r(e.eye.l,t.getParameterValueById("ParamEyeLOpen"),.7),r:r(e.eye.r,t.getParameterValueById("ParamEyeROpen"),.7)},e.head.y);t.setParameterValueById("ParamEyeLOpen",l.l),t.setParameterValueById("ParamEyeROpen",l.r),t.setParameterValueById("ParamMouthOpenY",r(e.mouth.y,t.getParameterValueById("ParamMouthOpenY"),.3)),t.setParameterValueById("ParamMouthForm",.3+r(e.mouth.x,t.getParameterValueById("ParamMouthForm"),.3))}})(d,.5))};!async function(){console.log("Environment: false");const e=new PIXI.Application({view:document.getElementById("live2d"),autoStart:!0,backgroundAlpha:0,backgroundColor:16777215,resizeTo:window});i=await a.from(n,{autoInteract:!1}),i.scale.set(.2),i.interactive=!0,i.anchor.set(.5,.5),i.position.set(.5*window.innerWidth,window.innerHeight),i.on("pointerdown",(e=>{i.offsetX=e.data.global.x-i.position.x,i.offsetY=e.data.global.y-i.position.y,i.dragging=!0})),i.on("pointerup",(e=>{i.dragging=!1})),i.on("pointermove",(e=>{i.dragging&&i.position.set(e.data.global.x-i.offsetX,e.data.global.y-i.offsetY)})),document.querySelector("#live2d").addEventListener("wheel",(e=>{e.preventDefault(),i.scale.set(o(i.scale.x+-.001*e.deltaY,-.5,10))})),e.stage.addChild(i),window.addEventListener?window.addEventListener("message",l,!1):window.attachEvent("onmessage",l)}()})();